<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SentinelX Admin Dashboard</title>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<!-- Leaflet Map -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body{
  background:#111;
  color:white;
  font-family:Arial;
  padding:20px;
}
#map{
  height:400px;
  margin-bottom:20px;
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  border:1px solid gray;
  padding:8px;
  text-align:center;
}
th{
  background:crimson;
}
</style>
</head>
<body>

<h2>üè´ Live Campus Monitoring</h2>

<div id="map"></div>

<table>
<tr>
<th>Name</th>
<th>Status</th>
<th>Live</th>
<th>Location</th>
</tr>
<tbody id="users"></tbody>
</table>

<script>

// üî• Same Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyBz80olPhD8ZUlaCSaXmojuseANyzuUOj8",
  authDomain: "sentinelx-blaze.firebaseapp.com",
  databaseURL: "https://sentinelx-blaze-default-rtdb.firebaseio.com",
  projectId: "sentinelx-blaze",
  storageBucket: "sentinelx-blaze.firebasestorage.app",
  messagingSenderId: "601578359867",
  appId: "1:601578359867:web:832a82427f67cb4468e01e"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Initialize Map
let map = L.map('map').setView([13.0827, 80.2707], 15);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
.addTo(map);

let markers = {};

// Real-time Listener
db.ref("users").on("value", function(snapshot) {

  let html = "";

  snapshot.forEach(function(child) {

    const u = child.val();
    const id = child.key;

    let locationLink = "-";

    if (u.latitude && u.longitude) {

      locationLink = `
      <a href="https://maps.google.com/?q=${u.latitude},${u.longitude}" target="_blank" style="color:cyan">
      View
      </a>`;

      if (!markers[id]) {
        markers[id] = L.marker([u.latitude, u.longitude]).addTo(map);
      } else {
        markers[id].setLatLng([u.latitude, u.longitude]);
      }
    }

    html += `
    <tr>
      <td>${u.name}</td>
      <td>${u.status}</td>
      <td>${u.live}</td>
      <td>${locationLink}</td>
    </tr>
    `;

  });

  document.getElementById("users").innerHTML = html;

});

</script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>SentinelX Pro</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
html,body{
    height:100%;
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background: linear-gradient(-45deg,#0f2027,#203a43,#2c5364,#1c1c1c);
    background-size:400% 400%;
    animation: gradient 10s ease infinite;
    color:white;
}
@keyframes gradient{
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
}

.container{
    max-width:1000px;
    margin:auto;
    padding:20px;
}

.card{
    background:rgba(255,255,255,0.08);
    backdrop-filter:blur(12px);
    padding:20px;
    border-radius:15px;
    margin-bottom:20px;
    box-shadow:0 0 20px rgba(0,0,0,0.6);
}

input,select{
    width:100%;
    padding:10px;
    margin:8px 0;
    border:none;
    border-radius:8px;
}

button{
    padding:12px;
    border:none;
    border-radius:8px;
    margin:6px 0;
    background:crimson;
    color:white;
    font-weight:bold;
    cursor:pointer;
}

button:hover{
    background:#ff1744;
}

#map{
    height:65vh;
    min-height:300px;
    width:100%;
    display:block;
    border-radius:15px;
    margin-top:10px;
}

.badge{
    padding:8px 15px;
    border-radius:20px;
    font-weight:bold;
    display:inline-block;
    margin-top:10px;
}

.low{ background:green; }
.medium{ background:orange; }
.high{ background:red; }

#countdownBox{
    margin-top:10px;
    font-size:18px;
    font-weight:bold;
}
</style>
</head>

<body>

<div class="container">

<h2>ðŸš¨ SentinelX Pro - Live Tracking</h2>

<div class="card">

<h3>Student Registration</h3>

<input id="name" placeholder="Name">
<select id="blood">
<option value="">Blood Group</option>
<option>A+</option><option>A-</option>
<option>B+</option><option>B-</option>
<option>AB+</option><option>AB-</option>
<option>O+</option><option>O-</option>
</select>

<input id="contact1" placeholder="Contact 1">
<input id="contact2" placeholder="Contact 2">

<button onclick="register()">Register</button>
<button onclick="startTracking()">Start Live Tracking</button>

<h3>ðŸš¨ Simulate Emergency</h3>

<button onclick="startEmergency('LOW')">Low Emergency</button>
<button onclick="startEmergency('MEDIUM')">Medium Emergency</button>
<button onclick="startEmergency('HIGH')">High Emergency</button>

<div id="countdownBox"></div>

</div>

<div class="card">
<h3>ðŸ“¡ Live Campus Monitoring</h3>
<div id="map"></div>
<div id="severityDisplay"></div>
</div>

</div>

<script>

let map;
let marker;
let currentSeverity="LOW";
let countdownInterval;

// Register user
function register(){
    const user={
        name:document.getElementById("name").value,
        blood:document.getElementById("blood").value,
        contacts:[
            document.getElementById("contact1").value,
            document.getElementById("contact2").value
        ].filter(Boolean)
    };

    if(!user.name || !user.blood){
        alert("Please fill required fields");
        return;
    }

    localStorage.setItem("sentinelUser",JSON.stringify(user));
    alert("Registered Successfully");
}

// Initialize Map
function initMap(lat,lon){

    map = L.map('map').setView([lat,lon],16);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
        attribution:'Â© OpenStreetMap'
    }).addTo(map);

    marker = L.marker([lat,lon]).addTo(map)
        .bindPopup("Live Location")
        .openPopup();

    setTimeout(()=>{
        map.invalidateSize();
    },800);
}

// Start Live Tracking
function startTracking(){

    if(!navigator.geolocation){
        alert("Geolocation not supported");
        return;
    }

    navigator.geolocation.watchPosition(
        pos=>{
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;

            if(!map){
                initMap(lat,lon);
            }else{
                marker.setLatLng([lat,lon]);
                map.setView([lat,lon]);
            }
        },
        err=>{
            alert("Location Error: " + err.message);
        },
        {
            enableHighAccuracy:true,
            timeout:15000,
            maximumAge:0
        }
    );
}

// Emergency with 10s cancel
function startEmergency(level){

    currentSeverity = level;

    if(!marker){
        alert("Start Live Tracking first");
        return;
    }

    let seconds=10;

    document.getElementById("countdownBox").innerHTML=
        `âš  Sending ${level} alert in 10 seconds...<br>
        <button onclick="cancelEmergency()">Cancel</button>`;

    countdownInterval=setInterval(()=>{
        seconds--;

        document.getElementById("countdownBox").innerHTML=
        `âš  Sending ${level} alert in ${seconds} seconds...<br>
        <button onclick="cancelEmergency()">Cancel</button>`;

        if(seconds<=0){
            clearInterval(countdownInterval);
            document.getElementById("countdownBox").innerHTML="";
            sendSMS();
        }
    },1000);
}

function cancelEmergency(){
    clearInterval(countdownInterval);
    document.getElementById("countdownBox").innerHTML="âŒ Emergency Cancelled";
}

// Send SMS
function sendSMS(){

    const data = JSON.parse(localStorage.getItem("sentinelUser"));
    if(!data){
        alert("Please register first");
        return;
    }

    const lat = marker.getLatLng().lat;
    const lon = marker.getLatLng().lng;

    const message =
`ðŸš¨ SentinelX EMERGENCY ðŸš¨
Name: ${data.name}
Blood Group: ${data.blood}
Severity: ${currentSeverity}
Location: https://maps.google.com/?q=${lat},${lon}`;

    const numbers = data.contacts.join(",");

    window.location.href =
        `sms:${numbers}?body=${encodeURIComponent(message)}`;

    document.getElementById("severityDisplay").innerHTML=`
        <h3>ðŸš¨ Emergency Status</h3>
        <span class="badge ${currentSeverity.toLowerCase()}">
        ${currentSeverity} SEVERITY
        </span>`;
}

</script>

</body>
</html>


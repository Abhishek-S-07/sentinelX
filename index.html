<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SentinelX Student</title>

<!-- Firebase v8 CDN -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
  font-family:Arial;
  background:#0f2027;
  color:white;
  text-align:center;
  padding:20px;
}
input{
  padding:10px;
  margin:8px;
  width:80%;
  border-radius:8px;
  border:none;
}
button{
  padding:10px 15px;
  margin:6px;
  background:crimson;
  color:white;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
button:hover{
  background:#ff1744;
}
</style>
</head>
<body>

<h2>üè´ SentinelX Student</h2>

<input id="name" placeholder="Name">
<input id="contact" placeholder="Emergency Contact (10 digits)" maxlength="10">

<br>
<button onclick="register()">Register</button>
<button onclick="startTracking()">Start Live Tracking</button>
<button onclick="triggerAlert()">Trigger Emergency</button>

<script>

// üî• Firebase Config (v8 format)
const firebaseConfig = {
  apiKey: "AIzaSyBz80olPhD8ZUlaCSaXmojuseANyzuUOj8",
  authDomain: "sentinelx-blaze.firebaseapp.com",
  databaseURL: "https://sentinelx-blaze-default-rtdb.firebaseio.com",
  projectId: "sentinelx-blaze",
  storageBucket: "sentinelx-blaze.firebasestorage.app",
  messagingSenderId: "601578359867",
  appId: "1:601578359867:web:832a82427f67cb4468e01e"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let userId = null;

// REGISTER
function register() {

  const phoneRegex = /^[0-9]{10}$/;
  if (!phoneRegex.test(contact.value)) {
    alert("Enter valid 10 digit number");
    return;
  }

  userId = Date.now();

  db.ref("users/" + userId).set({
    name: name.value,
    contact: contact.value,
    status: "ACTIVE",
    live: "OFF"
  });

  alert("Registered Successfully");
}

// LIVE TRACKING
function startTracking() {

  if (!userId) {
    alert("Register first");
    return;
  }

  navigator.geolocation.watchPosition(
    function(position) {

      db.ref("users/" + userId).update({
        latitude: position.coords.latitude,
        longitude: position.coords.longitude,
        live: "ON"
      });

    },
    function(error) {
      alert("Location Error: " + error.message);
    },
    { enableHighAccuracy: true }
  );
}

// EMERGENCY
function triggerAlert() {

  if (!userId) {
    alert("Register first");
    return;
  }

  db.ref("alerts/" + Date.now()).set({
    user: userId,
    severity: "HIGH",
    time: new Date().toLocaleString()
  });

  db.ref("users/" + userId).update({
    status: "EMERGENCY"
  });

  alert("Emergency Sent to Admin");
}

</script>
</body>
</html>

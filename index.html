<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SentinelX Student</title>

<!-- Firebase v8 CDN -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{font-family:Arial;background:#0f2027;color:white;text-align:center;padding:20px;}
input,select{padding:10px;margin:8px;width:80%;border-radius:8px;border:none;}
button{padding:10px;background:crimson;color:white;border:none;border-radius:8px;cursor:pointer;}
button:hover{background:#ff1744;}
</style>
</head>
<body>

<h2>üè´ SentinelX Student App</h2>

<input id="name" placeholder="Name">
<select id="building">
<option>Main Block</option>
<option>Lab Block</option>
<option>Library</option>
</select>
<select id="floor">
<option>Ground</option>
<option>1st</option>
<option>2nd</option>
</select>
<input id="room" placeholder="Room No">
<input id="contact" placeholder="Emergency Contact (10 digits)" maxlength="10">

<br>
<button onclick="register()">Register</button>
<button onclick="startTracking()">Start Live Tracking</button>
<button onclick="triggerAlert()">Trigger Emergency</button>

<script>

// üî• YOUR FIREBASE CONFIG (Converted to v8)
const firebaseConfig = {
  apiKey: "AIzaSyBz80olPhD8ZUlaCSaXmojuseANyzuUOj8",
  authDomain: "sentinelx-blaze.firebaseapp.com",
  databaseURL: "https://sentinelx-blaze-default-rtdb.firebaseio.com",
  projectId: "sentinelx-blaze",
  storageBucket: "sentinelx-blaze.firebasestorage.app",
  messagingSenderId: "601578359867",
  appId: "1:601578359867:web:832a82427f67cb4468e01e",
  measurementId: "G-ZQF87RGSJ7"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let currentUserID = null;

// REGISTER
function register(){

const phoneRegex=/^[0-9]{10}$/;

if(!phoneRegex.test(contact.value)){
alert("Enter valid 10 digit number");
return;
}

currentUserID = Date.now();

db.ref("users/" + currentUserID).set({
name: name.value,
building: building.value,
floor: floor.value,
room: room.value,
contact: contact.value,
status: "ACTIVE",
live: "OFF"
});

alert("Registered Successfully");
}

// LIVE TRACKING
function startTracking(){

if(!currentUserID){
alert("Register first");
return;
}

navigator.geolocation.watchPosition(position => {

const lat = position.coords.latitude;
const lon = position.coords.longitude;

db.ref("users/" + currentUserID).update({
latitude: lat,
longitude: lon,
live: "ON"
});

});
}

// TRIGGER ALERT
function triggerAlert(){

if(!currentUserID){
alert("Register first");
return;
}

db.ref("alerts/" + Date.now()).set({
userID: currentUserID,
severity: "HIGH",
time: new Date().toLocaleString()
});

db.ref("users/" + currentUserID).update({
status: "EMERGENCY"
});

alert("Emergency Sent to Admin");
}

window.onbeforeunload = function(){
if(currentUserID){
db.ref("users/" + currentUserID).update({
live: "OFF"
});
}
};

</script>
</body>
</html>

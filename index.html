<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SentinelX - Smart College Emergency</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background: linear-gradient(-45deg,#0f2027,#203a43,#2c5364,#1c1c1c);
    background-size:400% 400%;
    animation: gradient 10s ease infinite;
    color:white;
}
@keyframes gradient{
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
}

.container{
    max-width:1000px;
    margin:auto;
    padding:20px;
}

.card{
    background:rgba(255,255,255,0.08);
    backdrop-filter:blur(10px);
    padding:20px;
    border-radius:15px;
    margin-bottom:20px;
}

input,select{
    width:100%;
    padding:10px;
    margin:8px 0;
    border:none;
    border-radius:8px;
}

button{
    padding:12px;
    border:none;
    border-radius:8px;
    margin:6px 0;
    background:crimson;
    color:white;
    font-weight:bold;
    cursor:pointer;
}

button:hover{
    background:#ff1744;
}

#map{
    height:60vh;
    width:100%;
    border-radius:15px;
    margin-top:10px;
}

.badge{
    padding:8px 15px;
    border-radius:20px;
    font-weight:bold;
    display:inline-block;
    margin-top:10px;
}

.low{background:green;}
.medium{background:orange;}
.high{background:red;}

#countdownBox{
    margin-top:10px;
    font-weight:bold;
}
</style>
</head>

<body>

<div class="container">

<h2>üè´ SentinelX - Smart College Emergency</h2>

<div class="card">
<h3>Student Registration</h3>

<input id="name" placeholder="Name">

<select id="blood">
<option value="">Blood Group</option>
<option>A+</option><option>A-</option>
<option>B+</option><option>B-</option>
<option>AB+</option><option>AB-</option>
<option>O+</option><option>O-</option>
</select>

<h3>Campus Location</h3>

<select id="building">
<option value="">Select Building</option>
<option>Main Block</option>
<option>Lab Block</option>
<option>Library Block</option>
</select>

<select id="floor">
<option value="">Select Floor</option>
<option>Ground Floor</option>
<option>1st Floor</option>
<option>2nd Floor</option>
<option>3rd Floor</option>
</select>

<input id="room" placeholder="Room Number">

<h3>Emergency Contacts</h3>

<input id="contact1" type="tel" maxlength="10"
placeholder="Contact 1 (10 digits)">
<input id="contact2" type="tel" maxlength="10"
placeholder="Contact 2 (10 digits)">

<button onclick="register()">Register</button>
<button onclick="startTracking()">Start Live Tracking</button>

<h3>Simulate Emergency</h3>

<button onclick="startEmergency('LOW')">Low</button>
<button onclick="startEmergency('MEDIUM')">Medium</button>
<button onclick="startEmergency('HIGH')">High</button>

<div id="countdownBox"></div>

</div>

<div class="card">
<h3>Live Campus Monitoring</h3>
<div id="map"></div>
<div id="severityDisplay"></div>
</div>

</div>

<script>

let map;
let marker;
let currentSeverity="LOW";
let countdownInterval;

function register(){

const name=document.getElementById("name").value.trim();
const blood=document.getElementById("blood").value;
const building=document.getElementById("building").value;
const floor=document.getElementById("floor").value;
const room=document.getElementById("room").value.trim();
const contact1=document.getElementById("contact1").value.trim();
const contact2=document.getElementById("contact2").value.trim();

const phoneRegex=/^[0-9]{10}$/;

if(!name||!blood||!building||!floor){
alert("Fill all required fields");
return;
}

if(!phoneRegex.test(contact1)){
alert("Contact 1 must be exactly 10 digits");
return;
}

if(contact2 && !phoneRegex.test(contact2)){
alert("Contact 2 must be exactly 10 digits");
return;
}

const user={
name,blood,building,floor,room,
contacts:[contact1,contact2].filter(Boolean)
};

localStorage.setItem("sentinelUser",JSON.stringify(user));
alert("Registered Successfully");
}

function initMap(lat,lon){

map=L.map('map').setView([lat,lon],16);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
attribution:'¬© OpenStreetMap'
}).addTo(map);

marker=L.marker([lat,lon]).addTo(map);

setTimeout(()=>{map.invalidateSize();},800);
}

function startTracking(){

if(!navigator.geolocation){
alert("Geolocation not supported");
return;
}

navigator.geolocation.watchPosition(
pos=>{
const lat=pos.coords.latitude;
const lon=pos.coords.longitude;

if(!map){
initMap(lat,lon);
}else{
marker.setLatLng([lat,lon]);
map.setView([lat,lon]);
}
},
err=>{alert("Location Error: "+err.message);},
{enableHighAccuracy:true}
);
}

function startEmergency(level){

currentSeverity=level;

if(!marker){
alert("Start Live Tracking first");
return;
}

let seconds=10;

document.getElementById("countdownBox").innerHTML=
`Sending ${level} alert in 10 seconds...
<br><button onclick="cancelEmergency()">Cancel</button>`;

countdownInterval=setInterval(()=>{
seconds--;

document.getElementById("countdownBox").innerHTML=
`Sending ${level} alert in ${seconds} seconds...
<br><button onclick="cancelEmergency()">Cancel</button>`;

if(seconds<=0){
clearInterval(countdownInterval);
document.getElementById("countdownBox").innerHTML="";
sendSMS();
}
},1000);
}

function cancelEmergency(){
clearInterval(countdownInterval);
document.getElementById("countdownBox").innerHTML="Emergency Cancelled";
}

function sendSMS(){

const data=JSON.parse(localStorage.getItem("sentinelUser"));
if(!data){alert("Register first");return;}

const lat=marker.getLatLng().lat;
const lon=marker.getLatLng().lng;

const message=
`üö® SentinelX EMERGENCY üö®
Name: ${data.name}
Blood Group: ${data.blood}
Building: ${data.building}
Floor: ${data.floor}
Room: ${data.room}
Severity: ${currentSeverity}
Location: https://maps.google.com/?q=${lat},${lon}`;

const numbers=data.contacts.join(",");

window.location.href=
`sms:${numbers}?body=${encodeURIComponent(message)}`;

document.getElementById("severityDisplay").innerHTML=
`<span class="badge ${currentSeverity.toLowerCase()}">
${currentSeverity} SEVERITY
</span>`;
}

</script>
</body>
</html>
